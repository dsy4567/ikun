<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ikun 专属乐器</title>
    </head>
    <body>
        <h1>ikun 专属乐器</h1>
        <img src="jntm.jpg" alt="kun" />
        <hr />
        <button id="g1">高音1</button>
        <button id="g2">高音2</button>
        <button id="g3">高音3</button>
        <button id="g4">高音4</button>
        <button id="g5">高音5</button>
        <button id="g6">高音6</button>
        <button id="g7">高音7</button>
        <hr />
        <button id="z1">&emsp;1&emsp;</button>
        <button id="z2">&emsp;2&emsp;</button>
        <button id="z3">&emsp;3&emsp;</button>
        <button id="z4">&emsp;4&emsp;</button>
        <button id="z5">&emsp;5&emsp;</button>
        <button id="z6">&emsp;6&emsp;</button>
        <button id="z7">&emsp;7&emsp;</button>
        <button id="z0">&emsp;0&emsp;</button>
        <hr />
        <button id="d1">低音1</button>
        <button id="d2">低音2</button>
        <button id="d3">低音3</button>
        <button id="d4">低音4</button>
        <button id="d5">低音5</button>
        <button id="d6">低音6</button>
        <button id="d7">低音7</button>
        <hr />
        <textarea
            id="t"
            cols="50"
            rows="6"
            placeholder="曲谱, d1=低音do, z1=do, g1=高音do, 使用空格分隔"
        ></textarea>
        <br />
        <button onclick="document.querySelector('textarea#t').value+='\n'">
            空 格
        </button>
        <button class="play">演奏</button>
        <input placeholder="间隔(毫秒)" value="300" type="text" id="timeout" />
        <label>
            <input type="checkbox" id="c" />
            编谱模式
        </label>
        <br />
        <button>没用的按钮, 疯狂按可以让浏览器两刻半也不敢放松</button>
        <hr />
        <div>
            示例曲谱<br />
            <button data-name="赐我">赐我</button>
            <button data-name="鹿 be free">鹿 be free</button>
            <button data-name="玛丽的小羊羔">玛丽的小羊羔</button>
        </div>
        <script>
            var audio = {};
            document
                .querySelectorAll(
                    "button[id*='d'], button[id*='z'], button[id*='g']"
                )
                .forEach(async el => {
                    audio[el.id] = URL.createObjectURL(
                        await (await fetch(`audio/${el.id}.mp3`)).blob()
                    );
                    el.onmousedown = () => {
                        new Audio(audio[el.id]).play();
                    };
                    el.onclick = () => {
                        if (document.querySelector("input#c").checked) {
                            document.querySelector("textarea#t").value +=
                                " " + el.id;
                        }
                    };
                });
            document.querySelector(".play").onclick = () => {
                var n = 0;
                document
                    .querySelector("textarea#t")
                    .value.split(/[ \n]/)
                    .forEach(s => {
                        setTimeout(() => {
                            new Audio(audio[s]).play();
                        }, +document.querySelector("input#timeout").value * n++);
                    });
            };
            document.querySelectorAll("button[data-name]").forEach(el => {
                el.onclick = () => {
                    fetch(`示例曲谱/${el.dataset.name}.txt`).then(async res => {
                        document.querySelector("textarea#t").value =
                            await res.text();
                    });
                };
            });
        </script>
    </body>
</html>
