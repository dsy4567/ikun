<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <!-- Copyright (c) 2023 dsy4567, view license at <https://github.com/dsy4567/ikun/blob/main/LICENSE> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ikun 专属乐器</title>
        <style>
            @keyframes octocat-wave {
                0%,
                100% {
                    transform: rotate(0);
                }
                20%,
                60% {
                    transform: rotate(-25deg);
                }
                40%,
                80% {
                    transform: rotate(10deg);
                }
            }
            @media (max-width: 500px) {
                .github-corner:hover .octo-arm {
                    animation: none;
                }
                .github-corner .octo-arm {
                    animation: octocat-wave 560ms ease-in-out;
                }
            }
            html {
                color-scheme: light dark;
            }
            body {
                background: white;
                color: black;
            }
            .github-corner:hover .octo-arm {
                animation: octocat-wave 560ms ease-in-out;
            }
        </style>
    </head>
    <body>
        <a
            href="https://github.com/dsy4567/ikun"
            class="github-corner"
            aria-label="View source on GitHub"
            ><svg
                width="80"
                height="80"
                viewBox="0 0 250 250"
                style="
                    fill: #333;
                    color: #fff;
                    position: absolute;
                    top: 0;
                    border: 0;
                    right: 0;
                "
                aria-hidden="true"
            >
                <path
                    d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"
                ></path>
                <path
                    d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                    fill="currentColor"
                    style="transform-origin: 130px 106px"
                    class="octo-arm"
                ></path>
                <path
                    d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                    fill="currentColor"
                    class="octo-body"
                ></path>
            </svg>
        </a>
        <h1>ikun 专属乐器</h1>
        <img src="jntm.jpg" alt="kun" />
        <hr />
        <button id="g1">高音1</button>
        <button id="g2">高音2</button>
        <button id="g3">高音3</button>
        <button id="g4">高音4</button>
        <button id="g5">高音5</button>
        <button id="g6">高音6</button>
        <button id="g7">高音7</button>
        <hr />
        <button id="z1">&emsp;1&emsp;</button>
        <button id="z2">&emsp;2&emsp;</button>
        <button id="z3">&emsp;3&emsp;</button>
        <button id="z4">&emsp;4&emsp;</button>
        <button id="z5">&emsp;5&emsp;</button>
        <button id="z6">&emsp;6&emsp;</button>
        <button id="z7">&emsp;7&emsp;</button>
        <button id="z0">啊</button>
        <hr />
        <button id="d1">低音1</button>
        <button id="d2">低音2</button>
        <button id="d3">低音3</button>
        <button id="d4">低音4</button>
        <button id="d5">低音5</button>
        <button id="d6">低音6</button>
        <button id="d7">低音7</button>
        <hr />
        <textarea
            id="t"
            style="width: 100%; height: 114.514px"
            placeholder="曲谱, d1=低音do, z1=do, g1=高音do, 使用空格/换行分隔"
        ></textarea>
        <br />
        <button onclick="document.querySelector('textarea#t').value+=' '">
            空 格
        </button>
        <button onclick="document.querySelector('textarea#t').value+='\n'">
            换 行
        </button>
        <button
            onclick="document.querySelector('textarea#t').value=document.querySelector('textarea#t').value.substring(0,document.querySelector('textarea#t').value.length-3)"
        >
            退 格
        </button>
        <button class="play">演奏</button>
        <input placeholder="间隔(毫秒)" value="300" type="text" id="timeout" />
        <label>
            <input style="accent-color: #66ccff" type="checkbox" id="c" />
            编谱模式
        </label>
        <br />
        <input
            type="text"
            id="bgm"
            placeholder="url"
            value="https://music.163.com/song/media/outer/url?id=114514.mp3"
        />
        <button
            onclick="document.querySelector('textarea#t').value='!bgm:'+document.querySelector('#bgm').value+'\n'+document.querySelector('textarea#t').value"
        >
            添加背景阴乐
        </button>
        <br />
        <input type="text" id="comment" />
        <button
            onclick="document.querySelector('textarea#t').value+=' //'+document.querySelector('#comment').value+'\n'"
        >
            添加注释
        </button>
        <br />
        <button>
            请疯狂点击此按钮, 以保持交互状态, 让浏览器两刻半也不敢放松
        </button>
        <hr />
        <div>
            <span>示例曲谱</span><br />
            <button data-name="赐我">赐我</button>
            <button data-name="鹿 be free">鹿 be free</button>
            <button data-name="玛丽的小羊羔">玛丽的小羊羔</button>
        </div>
        <br />
        <span
            >Made with ♥ by
            <a href="https://github.com/dsy4567">dsy4567</a></span
        >
        <script>
            var audio = {};
            document
                .querySelectorAll(
                    "button[id^='d'], button[id^='z'], button[id^='g']"
                )
                .forEach(async el => {
                    audio[el.id] = URL.createObjectURL(
                        await (await fetch(`audio/${el.id}.mp3`)).blob()
                    );
                    el.onmousedown = () => {
                        new Audio(audio[el.id]).play();
                    };
                    el.onclick = () => {
                        if (document.querySelector("input#c").checked) {
                            document.querySelector("textarea#t").value +=
                                " " + el.id;
                        }
                    };
                });
            document.querySelector(".play").onclick = () => {
                var n = 0,
                    bgmurl = "",
                    p = document.querySelector("textarea#t").value;
                if (p.startsWith("!bgm:")) {
                    let m = p.match(/\!bgm\:.+\n/);
                    bgmurl = m[0].replace("!bgm:", "").replace("\n", "");
                    p = p.replace(m[0], "");
                }
                if (bgmurl) {
                    let bgm = new Audio(bgmurl);
                    bgmurl = "";
                    bgm.oncanplay = () => {
                        bgm.play();
                        setTimeout(() => {
                            p.replace(/(\n|\/\/.+\n)/g, "")
                                .split(" ")
                                .forEach(s => {
                                    setTimeout(() => {
                                        new Audio(audio[s]).play();
                                    }, +document.querySelector("input#timeout").value * n++);
                                });
                        }, +document.querySelector("input#timeout").value * n++);
                    };
                } else
                    p.replace(/(\n|\/\/.+\n)/g, "")
                        .split(" ")
                        .forEach(s => {
                            setTimeout(() => {
                                new Audio(audio[s]).play();
                            }, +document.querySelector("input#timeout").value * n++);
                        });
            };
            document.querySelectorAll("button[data-name]").forEach(el => {
                el.onclick = () => {
                    fetch(`示例曲谱/${el.dataset.name}.txt`).then(async res => {
                        document.querySelector("textarea#t").value =
                            await res.text();
                    });
                };
            });
        </script>
    </body>
</html>
